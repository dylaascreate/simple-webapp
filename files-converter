<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal File Converter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- jsPDF for Client Side Image to PDF conversion -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .drop-zone {
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%234F46E5FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }

        .drop-zone.active {
            background-color: #eff6ff; /* blue-50 */
            transform: scale(1.01);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c7c7c7; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }

        .animate-pulse-fast {
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Navbar -->
    <nav class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between shrink-0 z-10">
        <div class="flex items-center gap-3">
            <div class="bg-indigo-600 text-white p-2 rounded-lg">
                <i class="fa-solid fa-arrows-rotate fa-lg"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold text-gray-800">PolyConvert</h1>
                <p class="text-xs text-gray-500">Secure Client-Side Conversion</p>
            </div>
        </div>
        <div class="hidden md:flex gap-4 text-sm font-medium text-gray-600">
            <span class="hover:text-indigo-600 cursor-pointer">History</span>
            <span class="hover:text-indigo-600 cursor-pointer">Settings</span>
            <span class="hover:text-indigo-600 cursor-pointer">Help</span>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="flex flex-1 overflow-hidden">
        
        <!-- Sidebar (Supported Formats) -->
        <aside class="hidden lg:block w-64 bg-white border-r border-gray-200 p-6 overflow-y-auto shrink-0">
            <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-4">Supported Conversions</h3>
            
            <div class="space-y-1">
                <div class="flex items-center gap-3 p-2 bg-indigo-50 text-indigo-700 rounded-md cursor-pointer">
                    <i class="fa-regular fa-image w-5 text-center"></i>
                    <span class="text-sm font-medium">IMG to PDF</span>
                    <span class="ml-auto text-xs bg-indigo-200 px-2 py-0.5 rounded-full">Real</span>
                </div>
                <div class="flex items-center gap-3 p-2 bg-indigo-50 text-indigo-700 rounded-md cursor-pointer">
                    <i class="fa-solid fa-file-lines w-5 text-center"></i>
                    <span class="text-sm font-medium">TXT to PDF</span>
                    <span class="ml-auto text-xs bg-indigo-200 px-2 py-0.5 rounded-full">Real</span>
                </div>
                <div class="flex items-center gap-3 p-2 text-gray-600 hover:bg-gray-50 rounded-md cursor-pointer">
                    <i class="fa-regular fa-file-word w-5 text-center"></i>
                    <span class="text-sm font-medium">Word to PDF</span>
                    <span class="ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded-full text-gray-400">Demo</span>
                </div>
                <div class="flex items-center gap-3 p-2 text-gray-600 hover:bg-gray-50 rounded-md cursor-pointer">
                    <i class="fa-regular fa-file-excel w-5 text-center"></i>
                    <span class="text-sm font-medium">Excel to PDF</span>
                    <span class="ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded-full text-gray-400">Demo</span>
                </div>
                <div class="flex items-center gap-3 p-2 text-gray-600 hover:bg-gray-50 rounded-md cursor-pointer">
                    <i class="fa-regular fa-file-powerpoint w-5 text-center"></i>
                    <span class="text-sm font-medium">PPT to PDF</span>
                    <span class="ml-auto text-xs bg-gray-100 px-2 py-0.5 rounded-full text-gray-400">Demo</span>
                </div>
            </div>

            <div class="mt-8 p-4 bg-blue-50 rounded-xl border border-blue-100">
                <div class="text-blue-600 mb-2"><i class="fa-solid fa-shield-halved"></i></div>
                <h4 class="text-sm font-bold text-blue-800">Privacy First</h4>
                <p class="text-xs text-blue-600 mt-1 leading-relaxed">
                    Files are processed in your browser. No data is uploaded to any server.
                </p>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col relative overflow-y-auto p-4 md:p-8">
            
            <!-- Hero / Drop Zone -->
            <div class="max-w-4xl mx-auto w-full mb-8">
                <div class="text-center mb-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">Convert your files instantly</h2>
                    <p class="text-gray-500">Drag and drop files here to begin processing</p>
                </div>

                <!-- Drop Zone -->
                <div id="dropZone" class="drop-zone bg-white rounded-2xl p-10 md:p-16 text-center cursor-pointer relative group">
                    <input type="file" id="fileInput" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" multiple>
                    
                    <div class="relative z-0 pointer-events-none group-hover:scale-105 transition-transform duration-300">
                        <div class="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-sm">
                            <i class="fa-solid fa-cloud-arrow-up text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-700">Click to upload or drag and drop</h3>
                        <p class="text-sm text-gray-400 mt-2">TXT, IMG, PNG, JPG (Max 10MB)</p>
                        <p class="text-xs text-gray-300 mt-1">Simulation support for DOCX, XLSX, PPTX</p>
                    </div>
                </div>
            </div>

            <!-- File List Container -->
            <div id="fileListContainer" class="max-w-4xl mx-auto w-full hidden">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">Queue</h3>
                    <button onclick="clearAll()" class="text-xs text-red-500 hover:text-red-700 font-medium">Clear All</button>
                </div>
                
                <div id="fileList" class="space-y-3">
                    <!-- File items will be injected here -->
                </div>
            </div>

        </main>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-5 right-5 transform translate-y-20 opacity-0 transition-all duration-300 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-xl z-50 flex items-center gap-3">
        <i class="fa-solid fa-circle-check text-green-400"></i>
        <span id="toastMsg">Action successful</span>
    </div>

    <script>
        // --- Variables & Setup ---
        const { jsPDF } = window.jspdf;
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const fileListContainer = document.getElementById('fileListContainer');
        const toast = document.getElementById('toast');
        const toastMsg = document.getElementById('toastMsg');

        let filesQueue = [];

        // --- Event Listeners ---

        // Drag & Drop Effects
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                dropZone.classList.add('active');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                dropZone.classList.remove('active');
            }, false);
        });

        // Handle File Drop
        dropZone.addEventListener('drop', (e) => {
            const droppedFiles = e.dataTransfer.files;
            handleFiles(droppedFiles);
        });

        // Handle Click Upload
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
            fileInput.value = ''; // Reset input
        });

        // --- Core Logic ---

        function handleFiles(files) {
            if (files.length > 0) {
                fileListContainer.classList.remove('hidden');
                Array.from(files).forEach(file => {
                    const id = Math.random().toString(36).substring(7);
                    const fileObj = {
                        id,
                        file,
                        status: 'pending', // pending, converting, done, error
                        type: getFileType(file.name)
                    };
                    filesQueue.push(fileObj);
                    renderFileItem(fileObj);
                });
            }
        }

        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return 'image';
            if (['txt'].includes(ext)) return 'text';
            if (['pdf'].includes(ext)) return 'pdf';
            if (['doc', 'docx'].includes(ext)) return 'word';
            if (['xls', 'xlsx'].includes(ext)) return 'excel';
            if (['ppt', 'pptx'].includes(ext)) return 'ppt';
            return 'other';
        }

        function getIconForType(type) {
            const icons = {
                'image': 'fa-file-image text-purple-500',
                'text': 'fa-file-lines text-gray-600',
                'pdf': 'fa-file-pdf text-red-500',
                'word': 'fa-file-word text-blue-500',
                'excel': 'fa-file-excel text-green-500',
                'ppt': 'fa-file-powerpoint text-orange-500',
                'other': 'fa-file text-gray-400'
            };
            return icons[type] || icons['other'];
        }

        function formatBytes(bytes, decimals = 2) {
            if (!+bytes) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
        }

        function renderFileItem(fileObj) {
            const div = document.createElement('div');
            div.id = `file-${fileObj.id}`;
            div.className = "bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex flex-col sm:flex-row items-center gap-4 transition-all";
            
            div.innerHTML = `
                <div class="flex items-center gap-4 flex-1 w-full">
                    <div class="w-12 h-12 rounded-lg bg-gray-50 flex items-center justify-center shrink-0">
                        <i class="fa-regular ${getIconForType(fileObj.type)} text-xl"></i>
                    </div>
                    <div class="min-w-0 flex-1">
                        <h4 class="text-sm font-semibold text-gray-800 truncate" title="${fileObj.file.name}">${fileObj.file.name}</h4>
                        <p class="text-xs text-gray-400">${formatBytes(fileObj.file.size)}</p>
                    </div>
                </div>

                <div class="flex items-center gap-3 w-full sm:w-auto justify-end">
                    <div id="status-${fileObj.id}" class="hidden flex items-center gap-2">
                        <div class="w-32 h-2 bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-indigo-500 w-0 transition-all duration-[2000ms] ease-out" id="progress-${fileObj.id}"></div>
                        </div>
                        <span class="text-xs font-medium text-gray-500">0%</span>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div id="actions-${fileObj.id}" class="flex gap-2">
                        <select id="format-${fileObj.id}" class="bg-gray-50 border border-gray-200 text-xs rounded-lg px-2 py-2 outline-none focus:border-indigo-500 text-gray-600">
                            <option value="pdf" selected>to PDF</option>
                            <option value="png">to PNG</option>
                            <option value="txt">to Text</option>
                        </select>
                        <button onclick="startConversion('${fileObj.id}')" class="bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors shadow-sm shadow-indigo-200">
                            Convert
                        </button>
                        <button onclick="removeFile('${fileObj.id}')" class="text-gray-400 hover:text-red-500 px-2">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>

                    <!-- Download Button (Hidden initially) -->
                    <a id="download-${fileObj.id}" class="hidden bg-green-500 hover:bg-green-600 text-white text-xs font-medium px-4 py-2 rounded-lg shadow-sm shadow-green-200 transition-colors flex items-center gap-2 cursor-pointer">
                        <i class="fa-solid fa-download"></i> Download
                    </a>
                </div>
            `;
            fileList.appendChild(div);
        }

        function removeFile(id) {
            const el = document.getElementById(`file-${id}`);
            if (el) {
                el.style.opacity = '0';
                el.style.transform = 'translateX(20px)';
                setTimeout(() => el.remove(), 300);
                filesQueue = filesQueue.filter(f => f.id !== id);
                if (filesQueue.length === 0) fileListContainer.classList.add('hidden');
            }
        }

        function clearAll() {
            fileList.innerHTML = '';
            filesQueue = [];
            fileListContainer.classList.add('hidden');
        }

        // --- Conversion Logic ---

        async function startConversion(id) {
            const fileObj = filesQueue.find(f => f.id === id);
            if (!fileObj) return;

            // UI Updates
            document.getElementById(`actions-${id}`).classList.add('hidden');
            const statusContainer = document.getElementById(`status-${id}`);
            statusContainer.classList.remove('hidden');
            statusContainer.classList.add('flex');
            
            const progressBar = document.getElementById(`progress-${id}`);
            const statusText = statusContainer.querySelector('span');

            // Start Animation
            setTimeout(() => { progressBar.style.width = '40%'; statusText.innerText = '40%'; }, 100);

            try {
                let outputBlob;
                let outputName;

                // ACTUAL CONVERSION: Image to PDF
                if (fileObj.type === 'image') {
                    outputBlob = await convertImageToPDF(fileObj.file);
                    outputName = fileObj.file.name.split('.')[0] + ".pdf";
                } 
                // ACTUAL CONVERSION: Text to PDF
                else if (fileObj.type === 'text') {
                    outputBlob = await convertTextToPDF(fileObj.file);
                    outputName = fileObj.file.name.split('.')[0] + ".pdf";
                }
                // SIMULATED CONVERSION: Word/Excel/PPT/Text to PDF
                // Browser JS cannot easily convert these formats without a backend server.
                // We simulate the process for UX demonstration.
                else {
                    await simulateProcessingDelay();
                    outputBlob = new Blob(["This is a placeholder for the converted file.\n\nIn a real production environment, Word/Excel conversions require server-side processing or heavy WebAssembly modules which are too large for this single-file demo."], { type: "text/plain" });
                    outputName = fileObj.file.name.split('.')[0] + "_converted.txt";
                    showToast("Simulated conversion (Server required for real .docx)", true);
                }

                // Finish Animation
                progressBar.style.width = '100%';
                statusText.innerText = '100%';

                setTimeout(() => {
                    statusContainer.classList.add('hidden');
                    const downloadBtn = document.getElementById(`download-${id}`);
                    downloadBtn.classList.remove('hidden');
                    downloadBtn.classList.add('flex');
                    
                    // Attach Blob to Download Link
                    const url = URL.createObjectURL(outputBlob);
                    downloadBtn.href = url;
                    downloadBtn.download = outputName;
                    
                    showToast("Conversion Complete!");
                }, 500);

            } catch (error) {
                console.error(error);
                statusText.innerText = 'Error';
                statusText.classList.add('text-red-500');
                showToast("Conversion Failed", true);
            }
        }

        // Helper: Real Image to PDF using jsPDF
        function convertImageToPDF(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const imgData = event.target.result;
                    const pdf = new jsPDF();
                    
                    const imgProps = pdf.getImageProperties(imgData);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                    
                    pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
                    resolve(pdf.output('blob'));
                }
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Helper: Real Text to PDF using jsPDF
        function convertTextToPDF(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const text = event.target.result;
                    const pdf = new jsPDF();
                    
                    // Settings for text layout
                    const fontSize = 12;
                    const lineHeight = 7;
                    const margin = 15;
                    const pageWidth = pdf.internal.pageSize.getWidth();
                    const maxLineWidth = pageWidth - (margin * 2);

                    pdf.setFont("helvetica", "normal");
                    pdf.setFontSize(fontSize);
                    
                    // Split text into lines that fit the page width
                    const lines = pdf.splitTextToSize(text, maxLineWidth);
                    
                    let cursorY = margin + 5;
                    
                    lines.forEach(line => {
                        // Check if we need a new page
                        if (cursorY + lineHeight > pdf.internal.pageSize.getHeight() - margin) {
                            pdf.addPage();
                            cursorY = margin + 5;
                        }
                        pdf.text(line, margin, cursorY);
                        cursorY += lineHeight;
                    });
                    
                    resolve(pdf.output('blob'));
                }
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        // Helper: Simulation Delay
        function simulateProcessingDelay() {
            return new Promise(resolve => setTimeout(resolve, 2000));
        }

        // UI: Toast Notification
        function showToast(msg, isError = false) {
            toastMsg.innerText = msg;
            const icon = toast.querySelector('i');
            icon.className = isError ? "fa-solid fa-circle-exclamation text-red-400" : "fa-solid fa-circle-check text-green-400";
            
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

    </script>
</body>
</html>